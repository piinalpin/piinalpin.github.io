<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=X-UA-Compatible content="IE=edge, chrome=1"><title>How to Fix Kubernetes DNS Redirect to External on Proxmox - PiinAlpin Official Blog</title><meta name=Description content="This documentation is explaining how to solve DNS resolution not working and got 302 redirect when comunicationg between pod using a fully qualified domain name."><meta property="og:title" content="How to Fix Kubernetes DNS Redirect to External on Proxmox">
<meta property="og:description" content="This documentation is explaining how to solve DNS resolution not working and got 302 redirect when comunicationg between pod using a fully qualified domain name."><meta property="og:type" content="article"><meta property="og:url" content="https://piinalpin.com/2024/08/how-to-fix-kubernetes-dns-redirect-to-external-on-proxmox/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-15T11:09:25+07:00"><meta property="article:modified_time" content="2024-08-15T11:09:25+07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to Fix Kubernetes DNS Redirect to External on Proxmox"><meta name=twitter:description content="This documentation is explaining how to solve DNS resolution not working and got 302 redirect when comunicationg between pod using a fully qualified domain name."><meta name=twitter:site content="@piinalpin"><meta name=application-name content="PiinAlpin Official Blog"><meta name=apple-mobile-web-app-title content="PiinAlpin Official Blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=favicon.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://piinalpin.com/2024/08/how-to-fix-kubernetes-dns-redirect-to-external-on-proxmox/><link rel=prev href=https://piinalpin.com/2024/07/build-kubernetes-cluster-on-proxmox-ve/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"How to Fix Kubernetes DNS Redirect to External on Proxmox","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/piinalpin.com\/2024\/08\/how-to-fix-kubernetes-dns-redirect-to-external-on-proxmox\/"},"image":["https:\/\/piinalpin.com\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"Kubernetes, DNS Resolution, DNS, Proxmox","wordcount":316,"url":"https:\/\/piinalpin.com\/2024\/08\/how-to-fix-kubernetes-dns-redirect-to-external-on-proxmox\/","datePublished":"2024-08-15T11:09:25+07:00","dateModified":"2024-08-15T11:09:25+07:00","publisher":{"@type":"Organization","name":"Alvinditya","logo":"https:\/\/piinalpin.com\/images\/favicon.png"},"author":{"@type":"Person","name":"Alvinditya Saputra"},"description":"This documentation is explaining how to solve DNS resolution not working and got 302 redirect when comunicationg between pod using a fully qualified domain name."}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="PiinAlpin Official Blog"><span class=header-title-pre><i class='fa fa-code fa-fw'></i> </span><span id=id-1 class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/>About </a><a class=menu-item href=https://github.com/piinalpin title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="PiinAlpin Official Blog"><span class=header-title-pre><i class='fa fa-code fa-fw'></i> </span><span id=id-2 class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=https://github.com/piinalpin title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw'></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">How to Fix Kubernetes DNS Redirect to External on Proxmox</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://piinalpin.com/ title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>Alvinditya Saputra</a></span>&nbsp;<span class=post-category>included in <a href=/categories/documentation/><i class="far fa-folder fa-fw"></i>Documentation</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2024-08-15>2024-08-15</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;316 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;2 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents></nav></div></div><div class=content id=content><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/kubernetes-fqdn-302-found.png data-srcset="/images/kubernetes-fqdn-302-found.png, /images/kubernetes-fqdn-302-found.png 1.5x, /images/kubernetes-fqdn-302-found.png 2x" data-sizes=auto alt=/images/kubernetes-fqdn-302-found.png title="Kubernetes FQDN got 302 found"><br><br></p><p><strong>What Happened?</strong></p><p>I want deploy spring boot microservices and I have services called <code>dexter</code> and <code>enclave</code> and want communicate to each other using REST. They can communicate if I set service url using container hostname which is <code>dexter</code> and <code>enclave</code>. But somehow they won&rsquo;t communicate if I use Fully Qualified Domain Name (FQDN) on kubernetes and got <code>302 Found</code>. Seems redirect to external domain on public network which should not be registered.<br><br></p><p><strong>What did you expect to happen?</strong></p><p>Pods should resolve DNS and exposed service should be reachable.<br><br></p><p><strong>The Environment</strong></p><ul><li>Cloud Provider: <code>Proxmox 8.2 (Bare Metal)</code></li><li>Kubernetes Cluster Info<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;clientVersion&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;major&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;minor&#34;</span><span class=p>:</span> <span class=s2>&#34;25&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;gitVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;v1.25.9&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;gitCommit&#34;</span><span class=p>:</span> <span class=s2>&#34;a1a87a0a2bcd605820920c6b0e618a8ab7d117d4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;gitTreeState&#34;</span><span class=p>:</span> <span class=s2>&#34;clean&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;buildDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2023-04-12T12:16:51Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;goVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;go1.19.8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;compiler&#34;</span><span class=p>:</span> <span class=s2>&#34;gc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;platform&#34;</span><span class=p>:</span> <span class=s2>&#34;windows/amd64&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;kustomizeVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;v4.5.7&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;serverVersion&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;major&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;minor&#34;</span><span class=p>:</span> <span class=s2>&#34;30&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;gitVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;v1.30.3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;gitCommit&#34;</span><span class=p>:</span> <span class=s2>&#34;6fc0a69044f1ac4c13841ec4391224a2df241460&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;gitTreeState&#34;</span><span class=p>:</span> <span class=s2>&#34;clean&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;buildDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2024-07-16T23:48:12Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;goVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;go1.22.5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;compiler&#34;</span><span class=p>:</span> <span class=s2>&#34;gc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;platform&#34;</span><span class=p>:</span> <span class=s2>&#34;linux/amd64&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li>DNS Lookup<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nslookup google.com
</span></span><span class=line><span class=cl>Server:         192.168.1.1
</span></span><span class=line><span class=cl>Address:        192.168.1.1#53
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Non-authoritative answer:
</span></span><span class=line><span class=cl>google.com      canonical <span class=nv>name</span> <span class=o>=</span> forcesafesearch.google.com.
</span></span><span class=line><span class=cl>Name:   forcesafesearch.google.com
</span></span><span class=line><span class=cl>Address: 216.239.38.120
</span></span><span class=line><span class=cl>Name:   forcesafesearch.google.com
</span></span><span class=line><span class=cl>Address: 2001:4860:4802:32::78
</span></span></code></pre></td></tr></table></div></div></li></ul><br><p><strong>Root Cause?</strong></p><p>DNS Resolve <code>/etc/resolv.conf</code> on Proxmox VE have registered <code>search</code> name because when first install Proxmox that DNS must be filled. Thats why when create new VM from proxmox using cloud init, the dns resolve on VM (kubernetes node) was overrided from Proxmox VE and impacted the DNS resolution on kubernetes cluster.<br><br></p><p><strong>How to Solve?</strong></p><p>Remove kubernetes cluster and VM. Remove registered <code>search example.com</code> on your Proxmox VE bare metal. This example i use my router gateway ip and use google dns also take a note to adjust with your preference.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nameserver 192.168.1.1
</span></span><span class=line><span class=cl>nameserver 8.8.8.8
</span></span><span class=line><span class=cl>nameserver 8.8.4.4
</span></span></code></pre></td></tr></table></div></div><p>Create VM and reinstall kubernetes cluster, and that issue should be resolved.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2024-08-15</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/2024/08/how-to-fix-kubernetes-dns-redirect-to-external-on-proxmox/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://piinalpin.com/2024/08/how-to-fix-kubernetes-dns-redirect-to-external-on-proxmox/ data-title="How to Fix Kubernetes DNS Redirect to External on Proxmox" data-via=piinalpin data-hashtags="Kubernetes,DNS Resolution,DNS,Proxmox"><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://piinalpin.com/2024/08/how-to-fix-kubernetes-dns-redirect-to-external-on-proxmox/ data-hashtag=Kubernetes><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://piinalpin.com/2024/08/how-to-fix-kubernetes-dns-redirect-to-external-on-proxmox/><i class="fab fa-linkedin fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/kubernetes/>Kubernetes</a>,&nbsp;<a href=/tags/dns-resolution/>DNS Resolution</a>,&nbsp;<a href=/tags/dns/>DNS</a>,&nbsp;<a href=/tags/proxmox/>Proxmox</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/2024/07/build-kubernetes-cluster-on-proxmox-ve/ class=prev rel=prev title="Build Kubernetes Cluster on Proxmox VE"><i class="fas fa-angle-left fa-fw"></i>Build Kubernetes Cluster on Proxmox VE</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Piinalpin</div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://piinalpin.com/ target=_blank>Alvinditya Saputra</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/algoliasearch/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/typeit/typeit.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},data:{"id-1":"PiinAlpin","id-2":"PiinAlpin"},search:{algoliaAppID:"Z6ALHE0FJ2",algoliaIndex:"test-index",algoliaSearchKey:"7308da79f682ce9c1c5b0cf4c9eb9249",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"id-1":["id-1"],"id-2":["id-2"]},duration:0,speed:100}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>